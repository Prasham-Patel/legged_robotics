%% dp = [s, u, l]
function cost = cost_function(old_dp)
    dp = old_dp';
    s = [dp(1:3), dp(4:6), dp(7:9), dp(10:12), dp(13:15), dp(16:18)];
    u = [dp(19:21), dp(22:24), dp(25:27), dp(28:30), dp(31:33), dp(34:36)];
    lor = dp(37:42);
   
P_real = [  -198.652620637318	-305.243596942284	-195.661583315501	741.997701807997	651.021711705679	-178.404366077916	-165.459298202972	267.081421552471	200.979845292993	-135.611045389020	-227.400778504150	212.649058852182	-116.045961712271	195.618183625479	434.085333094122	-353.621049816948	-375.831209151239	451.658270306127
247.174324794419	330.000565498219	826.827518353042	363.935127030146	-131.737258616916	306.686063651782	-597.659591331359	590.799361425400	693.304650592778	-235.943171971316	567.364105858147	-408.509615878032	304.675437587008	-226.541599260439	-517.300980976379	570.975577039078	591.366295215507	-578.947908365761
975.037425022009	893.945192920123	352.716399011141	334.741622798008	384.157339626756	962.729332105419	729.197092550927	718.142745940911	615.666137160097	995.370316820258	762.405163876884	887.028901357684	971.181353813340	986.537407021496	704.210330544931	700.736509282918	658.152575293389	619.145387963162
0.0336948130115411	0.0343068984951118	0.0768354349814655	0.324102880854167	-0.0127732867930055	0.0338825430506423	0.0600087318939678	0.0960887067364001	0.113657118850304	0.0310513166546251	0.0336408509018953	-0.0123763005269782	0.0341606672560550	0.00234352632347220	-0.0618874501868709	0.0259413195366286	0.0233482648208483	-0.0841463307948405
-0.0745181323654679	-0.0648333252642071	0.279222404550562	-0.0789631532808930	-0.219802267100882	-0.0699552190873730	0.0357983907524201	-0.00797426845124068	0.0504289349421947	-0.0623847846531531	-0.0173499202976852	-0.0483793513512232	-0.0711892005468491	-0.0771197156768469	-0.0285427527069413	-0.0112572392937521	-0.000778428136222178	-0.000514107961008713
0.0375156598557651	0.0512513634078305	0.158030620551414	0.117339996569893	0.00473410575990830	0.0505842375326581	-0.137217746170868	0.128751809050077	0.145405324556230	-0.0601188307841117	0.104291659639477	-0.0797415383969660	0.0528604790064181	-0.0438657792441324	-0.0911210347632254	0.100515773991376	0.104423865536143	-0.101494628987231];



delta_l_nom = [483.109419847104	478.123083145968	367.594683713179	117.457690009343	13.7672736315174	478.395725830638	433.883315008060	319.135915492536	311.227245898038	489.319116023333	434.521860450268	392.372138566627	464.884950937802	423.043917301452	322.279919941560	453.200562337791	448.398520742080	303.690456760471
377.925744014413	326.958720940400	130.667319768324	293.451222891589	278.254132614081	368.250727131367	478.066070042905	281.481867257934	232.503977625222	481.183327293666	255.949583583983	505.694676655347	371.594472304361	500.537184490254	519.093984150715	237.134992183315	219.818785316036	518.338670914243
372.593271341305	318.641299813012	145.725505509254	339.609781773938	305.629627660696	365.473359059095	453.963847201143	309.982362819555	262.494314386555	467.030376629030	258.727110755996	502.253441879397	371.673020038970	500.597276611884	522.372644998508	233.378038682472	215.506071557507	521.018136406077
446.887968379768	423.942661165961	449.460825097019	468.650541476053	259.292359243035	459.762836074985	229.551247103531	506.171864726862	498.899694892422	380.421365013895	451.467194276006	363.586029126630	465.416459749844	423.522955900718	351.337778031799	430.846234327574	423.123562193867	327.956321619693
462.908408793896	446.765162644946	478.965823562594	447.736887988020	222.689943562494	476.219055567872	220.747842312644	510.944050560659	508.605275422110	381.823648440449	476.216282422458	344.166095393750	479.229838101706	410.915264291739	317.843425535028	461.295858957201	455.172910464308	290.772994605802
493.857489959323	492.820028757065	410.586849794302	145.032167265315	3.31770129816221	492.115591733133	401.496256650368	352.077810545273	350.053808833446	476.552068879802	461.912233878056	369.615879052564	478.775888844203	410.495702059682	291.820953250651	480.119495482591	476.425562668141	268.926261065768];

    for i = 1: 18
        P = P_real(1:6, i);
        o = P(1:3);
        R = Rx(P(4))*Ry(P(5))*Rz(P(6)); %Euler angles XYZ
        for j = 1:6
            l (: , j) = o + R * s(: , j) - u (: , j);
            L(j) = norm (l (: , j));
            N(:, j) = l (: , j)/L(j);
        end
%         cost(:, i) = L' - (delta_l_nom(1:6, i) + lor);
        cost(:, i) = (L.*L)' - (delta_l_nom(1:6, i) + lor).*(delta_l_nom(1:6, i) + lor);
    end
    end   